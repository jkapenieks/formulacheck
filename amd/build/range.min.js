define("assignsubmission_formulacheck/range",["exports","core/str"],function(_exports,Str){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Str=function(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return function(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,default:e};if(null===e||"object"!=typeof e&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f)}for(const t in e)"default"!==t&&{}.hasOwnProperty.call(e,t)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,t))&&(i.get||i.set)?o(f,t,i):f[t]=e[t]);return f}(e,t)}(Str);const mark=async el=>{var _el$value;const{min:min,max:max}=(el=>({min:void 0!==el.dataset.min&&""!==el.dataset.min?parseFloat(el.dataset.min):null,max:void 0!==el.dataset.max&&""!==el.dataset.max?parseFloat(el.dataset.max):null}))(el),raw=(null!==(_el$value=el.value)&&void 0!==_el$value?_el$value:"").trim(),required=""===raw,val=(txt=>{if(null===txt)return NaN;const t=String(txt).trim();return t?parseFloat(t.replace(",",".")):NaN})(raw);let ok;ok=!required&&(!isNaN(val)&&(null===min||val>=min)&&(null===max||val<=max));const fb=(el=>{let fb=el.nextElementSibling;return fb&&fb.classList.contains("invalid-feedback")||(fb=document.createElement("div"),fb.className="invalid-feedback",el.insertAdjacentElement("afterend",fb)),fb})(el);return el.classList.toggle("is-invalid",!ok),el.classList.toggle("is-valid",ok&&""!==raw),el.setAttribute("aria-invalid",String(!ok)),fb.textContent=ok?"":await(async(state,val,min,max)=>"required"===state?await Str.get_string("rangejs_required","assignsubmission_formulacheck"):isNaN(val)?await Str.get_string("rangejs_numeric","assignsubmission_formulacheck"):null!==min&&null!==max&&(val<min||val>max)?await Str.get_string("rangejs_between","assignsubmission_formulacheck",{min:min,max:max}):null!==min&&val<min?await Str.get_string("rangejs_min","assignsubmission_formulacheck",min):null!==max&&val>max?await Str.get_string("rangejs_max","assignsubmission_formulacheck",max):"")(required?"required":"range",val,min,max),fb.style.display=ok?"none":"",ok},validateAll=async fields=>{const results=[];for(const el of fields)results.push(await mark(el));return results.every(Boolean)},randomFloat=(min,max)=>{const lower=null!==min?min:-10,upper=null!==max?max:10;return lower+Math.random()*(upper-lower)};_exports.init=async selector=>{const fields=Array.from(document.querySelectorAll(selector));if(!fields.length)return;const form=fields[0].closest("form");fields.forEach(el=>el.addEventListener("input",()=>mark(el))),form&&form.addEventListener("submit",async e=>{if(!await validateAll(fields)){e.preventDefault();const firstBad=fields.find(f=>f.classList.contains("is-invalid"));firstBad&&firstBad.focus()}});const randomButton=document.getElementById("id_assignsubmission_formulacheck_generate_random");randomButton&&randomButton.addEventListener("click",async e=>{e.preventDefault(),await(async buttonEl=>{const rangesData=JSON.parse(buttonEl.dataset.ranges||"[]"),rangesMap=new Map;for(const data of Object.values(rangesData))rangesMap.set(data.field_name,data);let needsUpdate=!1;for(const[fieldName,range]of rangesMap.entries()){const inputField=document.querySelector('input[name="'.concat(fieldName,'"]'));if(inputField){const minVal=null!==range.min?parseFloat(range.min):null,maxVal=null!==range.max?parseFloat(range.max):null,randomVal=randomFloat(minVal,maxVal).toFixed(2);inputField.value=randomVal,needsUpdate=!0}}if(needsUpdate){const allFields=Array.from(document.querySelectorAll("input[name^=assignsubmission_formulacheck_p]"));await validateAll(allFields)}})(randomButton)}),await validateAll(fields)}});

//# sourceMappingURL=range.min.js.map